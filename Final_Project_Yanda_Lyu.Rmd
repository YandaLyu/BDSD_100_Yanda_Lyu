---
title: "Final_Project_Yanda_Lyu"
author: "Yanda Lyu"
date: "2021/11/16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r}
library(dplyr)
```

```{r}
athlete = read.csv("athlete_events.csv")
names(athlete) #有哪些指标

unique(athlete$Sport) #奥运会有哪些基本项目类别
length(unique(athlete$Sport)) # 类别个数
sort(table(athlete$Sport), decreasing = T) # 大致看一下参与人数、项目举办次数多的几项运动
chn = athlete[which(athlete$NOC == "CHN"),] 
chn[order(chn$Year),][1,] #1932年中国首次出战奥运
```

```{r}
a2 = athlete %>% filter(Season == "Summer") %>% group_by(Year, Season) %>% summarise(number_of_ath = n()) #看异常值，判断标准，前一年和后一年都比该年参赛人数多至少2000人
for (i in 2: nrow(a2)-1){
  if (a2$number_of_ath[i+1] > a2$number_of_ath[i] + 2000){
    if (a2$number_of_ath[i-1] > a2$number_of_ath[i] + 2000){
      print (a2$Year[i])
    }
  }
}

a2$number_of_ath[9]-a2$number_of_ath[10]
a2$number_of_ath[13]-a2$number_of_ath[14]
```

```{r}
library(tidyverse)
ggplot(na.omit(athlete)) + geom_density(aes(x=Age,fill=Sex),alpha = 0.5) +  labs(title = "distribution of age") #不同性别的年龄段密度图分析

library(MASS)   #男/女运动员在夏/冬的年龄分布
par(mfrow=c(2,2))
malesummer = athlete %>% filter(Sex == "M") %>% filter(Season == "Summer")
malewinter = athlete %>% filter(Sex == "M") %>% filter(Season == "Winter")
femalesummer = athlete %>% filter(Sex == "F") %>% filter(Season == "Summer")
femalewinter = athlete %>% filter(Sex == "F") %>% filter(Season == "Winter")
hist(malesummer$Age , xlim = c(0,60),xlab = "age", main ="summer male athletes'age" )
hist(malewinter$Age , xlim = c(0,60),xlab = "age", main ="winter male athletes'age")
hist(femalesummer$Age , xlim = c(0,60),xlab = "age", main ="summer female athletes'age")
hist(femalewinter$Age , xlim = c(0,60),xlab = "age", main ="winter female athletes'age")

```

```{r}
# 近20年来运动员的身高、体重
ath20 <- athlete %>% filter(!is.na(Height), !is.na(Weight), Year > 2017-20)
ggplot(ath20,aes(x = as.factor(Year), y = Weight, fill = Sex)) + geom_boxplot() + labs(title = "Athletes' Weight" , xlab = "year") #体重
ggplot(ath20,aes(as.factor(Year), y = Height, fill = Sex)) + geom_boxplot() + labs(title = "Athletes' Height" , xlab = "year") #身高
ggplot(athlete,aes(x = Weight, y = Height)) + geom_point(aes(color=Sex),cex = 0.2 , alpha = 0.5) + facet_wrap(~Sex) + geom_smooth(method="lm") + ggtitle("Weight vs Height") #体重与身高
```

```{r}
a3 = athlete %>% group_by(Age,Sex) %>% summarise(sum_of_medals = n())
ggplot(a3,aes(x=Age,y=sum_of_medals))+geom_point(size=1)+geom_smooth(se=FALSE) + scale_x_continuous(breaks = seq(0, 100, 10)) + labs(y = "sum of medals", title = "Total number of medals VS Age ")
ggplot(a3,aes(x=Age,y=sum_of_medals,color=Sex))+geom_point(size=1)+geom_smooth(se=FALSE) + scale_x_continuous(breaks = seq(0, 100, 10))  + labs(y = "sum of medals", title = "Medals won by different sexes VS Age ")
#运动员在不同年龄拿奖牌数的散点图和拟合曲线。
#按性别划分
```

```{r}
male_ball = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% group_by(NOC) #各国男子球类项目

usa_chn_height = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% filter(NOC %in% c("USA","CHN")) %>% filter (Height != "NA") %>% group_by(Year,NOC) %>% summarise(height = mean(Height)) #中美国男子球类项目历届平均身高
usa_chn_age = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% filter(NOC %in% c("USA","CHN")) %>% filter (Age != "NA") %>% group_by(Year,NOC) %>% summarise(age = mean(Age)) 
#中美国男子球类项目历届平均年龄
usa_chn_rus_height = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% filter(NOC %in% c("USA","RUS","CHN")) %>% filter (Height != "NA") %>% group_by(Year,NOC) %>% summarise(height = mean(Height))
#中美俄国男子球类项目历届平均身高
usa_chn_rus_age = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% filter(NOC %in% c("USA","RUS","CHN")) %>% filter (Age != "NA") %>% group_by(Year,NOC) %>% summarise(age = mean(Age))
#中美俄国男子球类项目历届平均年龄
t.test(usa_chn_height$height ~ usa_chn_height$NOC)
t.test(usa_chn_age$age ~ usa_chn_age$NOC)
aov(usa_chn_rus_height$height ~ usa_chn_rus_height$NOC)
summary(aov(usa_chn_rus_height$height ~ usa_chn_rus_height$NOC))
aov(usa_chn_rus_age$age ~ usa_chn_rus_age$NOC)
summary(aov(usa_chn_rus_age$age ~ usa_chn_rus_age$NOC))
#为比较是否获奖牌数有显著差异，引入t检验。p值若小于0.05。则拒绝原假设，认为有显著差异。
```

```{r}
male_ball = athlete %>% filter(Sex == "M") %>% filter(grepl("ball",Sport)) %>% group_by(NOC) #各国男子球类项目
gmed = male_ball %>% filter(Medal == "Gold") %>% summarise(sum = n())   #各国金银铜的中位数
median(gmed$sum) 
smed = male_ball %>% filter(Medal == "Silver") %>% summarise(sum = n())
median(smed$sum)
bmed = male_ball %>% filter(Medal == "Bronze") %>% summarise(sum = n())
median(bmed$sum)
gold = male_ball %>% filter(Medal == "Gold") %>% summarise(gold = ifelse(n()>25,ifelse(n()>50,3,2),1)) #>50，记作3；26-50，记作2；1-25，记作1
silver = male_ball %>% filter(Medal == "Silver") %>% summarise(silver = ifelse(n()>25,ifelse(n()>50,3,2),1))
bronze = male_ball %>% filter(Medal == "Bronze") %>% summarise(bronze = ifelse(n()>25,ifelse(n()>50,3,2),1))
medal3 =gold %>% left_join(silver) %>% left_join(bronze)
medal3[is.na(medal3)] = 1
medaldf = data.frame(row.names = medal3$NOC , gold=medal3$gold,silver=medal3$silver,bronze=medal3$bronze)
medaldf    #获得过男子球类项目奖牌的30国金银铜牌数表

dd=dist(medaldf)
hc=hclust(dd)
plot(hc,hang=-1,cex=.8 )
```

